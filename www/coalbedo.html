<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<!-- can't be viewed locally as file:// in most browsers -->

<head>
	<title>untitled</title>
	<link type="text/css" href="css/smoothness/jquery-ui-1.8.16.custom.css" rel="stylesheet" />	
	<script src="js/processing-1.3.6.min.js"></script>
	<script src="js/jquery-1.6.2.min.js"></script>
	<script src="js/jquery-ui-1.8.16.custom.min.js"></script>

    <script>  
        function drawCoalbedoFactor(id) {  
            var pjs = Processing.getInstanceById(id);  
            var g = document.getElementById('gamma').value;  
            pjs.drawCoalbedoFactor(-50, 50, g); 
		}
        function drawTemperatureBalance(id) {  
            var pjs = Processing.getInstanceById(id);  
            var g = document.getElementById('gamma').value;  
            pjs.drawTemperatureBalance(-50, 50, g); 
		}
		function tanh(x) {
		    if( x < -3 )
		        return -1;
		    else if( x > 3 )
		        return 1;
		    else
		        return x * ( 27 + x * x ) / ( 27 + 9 * x * x );
		}
		function coalbedoFactor(g, t) {
			var ai = 0.3;
			var af = 0.8;
			return ai + 0.5 * (af - ai) * (1.0 + tanh(g * t));
		}
		function temperatureBalance(g, t) {
			// courtesy of Staffan's sage notebook:
			//   http://www.azimuthproject.org/azimuth/show/Experiments+with+ice+albedo+feedback
			// (19*T + 2180)/(2*tanh(T*gamma) + 5) 
			return (19 * t + 2180) / (2 * tanh(g * t) + 5); 
		}
    </script>

    <script>
	$(function() {
		$( "#slider" ).slider({
			value:0.0,
			min: 0.0,
			max: 1.0,
			step: 0.01,
			slide: function( event, ui ) {
				$( "#gamma" ).val( ui.value );
				drawCoalbedoFactor('coalbedo-sketch');
				drawTemperatureBalance('temperature-balance-sketch');
			}
		});
		$( "#gamma" ).val( $( "#slider" ).slider( "value" ) );
	});
	</script>
	
	<style type="text/css">
		/*demo page css*/
		body{ font: 62.5% "Trebuchet MS", sans-serif; margin: 50px;}
	</style>
</head>
<body>
	<div class="demo">

		<p>
			<label for="gamma">Gamma (0.01 increments):</label>
			<input type="text" id="gamma" style="border:0; color:#f6931f; font-weight:bold;" />
		</p>

		<div id="slider" style="width:200px;"></div>
		<p></p>
		<canvas id="coalbedo-sketch" data-processing-sources="pde/coalbedo.pde" width="200" height="200"></canvas>  

		<p></p>
		<canvas id="temperature-balance-sketch" data-processing-sources="pde/temperature-balance.pde" width="200" height="200"></canvas>

	</div>

</html>
