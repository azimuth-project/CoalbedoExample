<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<!-- can't be viewed locally as file:// in most browsers -->

<head>
    <title>Azimuth simple climate model example</title>
    <link type="text/css" href="css/smoothness/jquery-ui-1.8.16.custom.css" rel="stylesheet" /> 
    <script type="text/javascript" src="js/jquery-1.6.2.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.8.16.custom.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jsxgraph/0.92/jsxgraphcore.js">
    </script>
    
    <script>
    function currentGamma() {
        return $( "#gamma" ).val();
    }
    
    var INIT_GAMMA = 0.0;
    
    var COALBEDO_T0 = -50.0;
    var COALBEDO_T1 = 50.0;
    
    var COALBEDO_LINE_COLOR = 0xDDFF0000;
    
    var INSOLATION_T0 = -50.0;
    var INSOLATION_T1 = 50.0;
    
    var INSOLATION_LINE_COLOR = 0xDDFF0000;

    var TEMPERATURE_T0 = -50.0;
    var TEMPERATURE_T1 = 50.0;
    
    var TEMPERATURE_LINE_COLOR = 0xDDFF0000;
    
    var BACKGROUND_COLOR = 0xFFDDDDDD;
    var AXES_COLOR = 0xFF000000;
    var GRID_COLOR = 0xFFFFFFFF;
    
    // rational approximation to tanh, as gratefully scraped from SO:
    //   http://stackoverflow.com/questions/6118028/fast-hyperbolic-tangent-approximation-in-javascript
    function rational_tanh(x) {
        if ( x < -3 )
            return -1.0;
        else if ( x > 3 )
            return 1.0;
        else
            return x * ( 27 + x * x ) / ( 27 + 9 * x * x );
    }
    function tanh(x) {
        return rational_tanh(x);
    }
    function coalbedo(g, T) {
        var ai = 0.38;  // ice-i planet
        var af = 0.71;  // ice-free planet
        var ap = ai + 0.5 * (af - ai) * (1.0 + tanh(g * T));
        return ap;
    }
    var INSOLATION_A = 218.0;   // watts per square meter
    var INSOLATION_RATE_B = 1.9;     // watts per square meter per celcius
    var HEAT_CAPACITY = 0.5 * 1e7; 
    function insolationEq(g, T) {
        var A = INSOLATION_A;
        var B = INSOLATION_RATE_B;
        var ap = coalbedo(g, T);
        var Qeq = (A + B * T) / ap;
        return Qeq;
    }
    function rateOfTemperatureChange(g, q, T) {
        var A = INSOLATION_A;
        var B = INSOLATION_RATE_B;
        var C = HEAT_CAPACITY;
        var ap = coalbedo(g, T);
        var dT_dt = (-A - B * T + q * ap) / C;
        return dT_dt;
    }
    </script>

    <script>
    $(function() {
        $( "#slider" ).slider({
            value:0.0,
            min: 0.0,
            max: 0.1,
            step: 0.001,
            slide: function( event, ui ) {
                var g = ui.value;
                var s = $( "#gamma" );
                s.val( g );
                coalbedoBoard.update(s);
                insolationBoard.update(s);
                temperatureBoard.update(s);
            }
        });
        $( "#gamma" ).val( $( "#slider" ).slider( "value" ) );
    });
    </script>   

</head>


<body>
    <div class="slider" style="width:400px; font: 62.5%">
        <p>
            <label for="gamma">Transition rate \(\gamma\) from icey coalbedo \(a_i\) to ice-free coalbedo \(a_f\)  (0.01 increments):</label>
            <input type="text" id="gamma" style="border:0; color:#f6931f; font-weight:bold;" />
        </p>

        <div id="slider"></div>
    </div>
    
    <div class="coalbedo-charts">
        <p>Co-albedo \(a_p\) for selected \(\gamma\).</p>
        <div id="coalbedo-box" class="jxgbox" style="width:500px; height:250px;"></div>
        <p>Insolation \(Q_\text{eq}\) required to yield a given temperature \(T\) between -50C and 50C.</p>
        <div id="insolation-box" class="jxgbox" style="width:500px; height:250px;"></div>
        <p>Temperature \(T_\text{eq}\) given insolation \(Q\) between 200 and 500.</p>
        <div id="temperature-box" class="jxgbox" style="width:500px; height:500px;"></div>
        <script type="text/javascript">
            JXG.Options.renderer = "canvas";
            var coalbedoBoard = JXG.JSXGraph.initBoard('coalbedo-box', {boundingbox: [-50, 0.75, 50, -0.05], axis:true, showCopyright:false});
            var insolationBoard = JXG.JSXGraph.initBoard('insolation-box', {boundingbox: [-50, 600, 50, -20], axis:true, showCopyright:false});
            var temperatureBoard = JXG.JSXGraph.initBoard('temperature-box', {boundingbox: [200, 50, 500, -50], axis:true, showCopyright:false});
            
            coalbedoBoard.create('functiongraph', [function(T){return coalbedo(currentGamma(), T);}], {strokeWidth:3});
            insolationBoard.create('functiongraph', [function(T){return insolationEq(currentGamma(), T);}], {strokeWidth:3});
            temperatureBoard.create('curve', [function(T){return insolationEq(currentGamma(), T);}, function(T){return T;}, -50, 50], {strokeWidth:3});
        </script>
    </div>
    
</body>
</html>
