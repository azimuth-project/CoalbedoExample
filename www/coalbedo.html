<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<!-- can't be viewed locally as file:// in most browsers -->

<head>
    <title>Azimuth simple climate model example</title>
    <link type="text/css" href="css/smoothness/jquery-ui-1.8.16.custom.css" rel="stylesheet" /> 
    <script src="js/processing-1.3.6.min.js"></script>
    <script src="js/jquery-1.6.2.min.js"></script>
    <script src="js/jquery-ui-1.8.16.custom.min.js"></script>
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>
    
    <script>
    var INIT_GAMMA = 0.0;
    
    var COALBEDO_WIDTH = 400;
    var COALBEDO_HEIGHT = 200;
    var COALBEDO_T0 = -50.0;
    var COALBEDO_T1 = 50.0;
    
    var COALBEDO_LINE_COLOR = 0xDDFF0000;
    
    var INSOLATION_WIDTH = 400;
    var INSOLATION_HEIGHT = 200;
    var INSOLATION_T0 = -50.0;
    var INSOLATION_T1 = 50.0;
    
    var INSOLATION_LINE_COLOR = 0xDDFF0000;
    
    var BACKGROUND_COLOR = 0xFFDDDDDD;
    var AXES_COLOR = 0xFF000000;
    var GRID_COLOR = 0xFFFFFFFF;
    
    function drawCoalbedo(id, g) {  
        var pjs = Processing.getInstanceById(id);  
        // var g = document.getElementById('gamma').value;  
        pjs.drawCoalbedo(g); 
    }
    function drawInsolation(id, g) {  
        var pjs = Processing.getInstanceById(id);  
        // var g = document.getElementById('gamma').value;  
        pjs.drawInsolation(g); 
    }
    // rational approximation to tanh, as gratefully scraped from SO:
    //   http://stackoverflow.com/questions/6118028/fast-hyperbolic-tangent-approximation-in-javascript
    function rational_tanh(x) {
        if ( x < -3 )
            return -1.0;
        else if ( x > 3 )
            return 1.0;
        else
            return x * ( 27 + x * x ) / ( 27 + 9 * x * x );
    }
    function tanh(x) {
        return rational_tanh(x);
    }
    function coalbedo(g, t) {
        var ai = 0.38;  // ice-i planet
        var af = 0.71;  // ice-free planet
        var ap = ai + 0.5 * (af - ai) * (1.0 + tanh(g * t));
        return ap;
    }
    function insolation(g, t) {
        var A = 218.0;   // watts per square meter
        var B = 1.9;     // watts per square meter per celcius
        var ap = coalbedo(g, t);
        var Qeq = (A + B * t) / ap;
        return Qeq;
    }
    </script>

    <script>
    $(function() {
        $( "#slider" ).slider({
            value:0.0,
            min: 0.0,
            max: 1.0,
            step: 0.01,
            slide: function( event, ui ) {
                var g = ui.value;
                $( "#gamma" ).val( g );
                drawCoalbedo('coalbedo-sketch', g);
                drawInsolation('insolation-sketch', g);
            }
        });
        $( "#gamma" ).val( $( "#slider" ).slider( "value" ) );
    });
    </script>   

    <style type="text/css">
    body{ font: 100% "Trebuchet MS", sans-serif; margin: 50px;}
    </style>

</head>
<body>
    <div class="gamma-slider" style="width:400px; font: 62.5%">
        <p>
            <label for="gamma">Transition rate \(\gamma\) from icey coalbedo \(a_i\) to ice-free coalbedo \(a_f\)  (0.01 increments):</label>
            <input type="text" id="gamma" style="border:0; color:#f6931f; font-weight:bold;" />
        </p>

        <div id="slider"></div>
    </div>

    <div class="coalbedo-charts">
        <p>Co-albedo \(a_p\) for selected \(\gamma\).</p>
        <canvas id="coalbedo-sketch" data-processing-sources="pde/coalbedo.pde" width="400" height="200"></canvas>  

        <p>Insolation \(Q_\text{eq}\) required to yield a given temperature \(T\) between -50C and 50C.</p>
        <canvas id="insolation-sketch" data-processing-sources="pde/insolation.pde" width="400" height="200"></canvas>
    </div>
</body>
</html>
